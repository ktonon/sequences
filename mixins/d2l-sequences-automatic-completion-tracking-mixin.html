<link rel="import" href="d2l-sequences-completion-tracking-mixin.html">
<script>
	(function() {
		function AutomaticCompletionTrackingMixin() {
			return class extends D2L.Polymer.Mixins.Sequences.CompletionTrackingMixin() {

				static get properties() {
					return {
						href: {
							type: String,
							observer: '_onHrefChanged',
							reflectToAttribute: true,
							notify: true
						},
						_previousHref: {
							type: String
						}
					};
				}

				static get observers() {
					return ['_entityUpdated(entity)'];
				}

				disconnectedCallback() {
					super.disconnectedCallback();
					this.finishCompletion();
				}

				_onHrefChanged(href, previousHref) {
					this._previousHref = previousHref;
				}

				_entityUpdated() {
					if (this.href !== this._previousHref) {
						this.finishCompletion();
						this.startCompletion();
						this.topicSetDashboardViewState();
						this._previousHref = this.href;
					}
				}
			};
		}

		window.D2L = window.D2L || {};
		window.D2L.Polymer = window.D2L.Polymer || {};
		window.D2L.Polymer.Mixins = window.D2L.Polymer.Mixins || {};
		window.D2L.Polymer.Mixins.Sequences = window.D2L.Polymer.Mixins.Sequences || {};
		window.D2L.Polymer.Mixins.Sequences.AutomaticCompletionTrackingMixin = AutomaticCompletionTrackingMixin;
	})();
</script>
